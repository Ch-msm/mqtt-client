## **Web版MQTT客户端需求文档**

**版本:** 1.0
**日期:** 2025年5月6日

**1. 引言**

*   **1.1 项目目标:** 开发一个基于Web的单页面MQTT客户端应用程序。该应用程序允许用户连接到MQTT代理（Broker），发布消息到指定主题，并订阅主题以接收和显示消息。
*   **1.2 项目范围:** 本文档定义了该Web客户端的功能需求、非功能需求和用户界面（UI）布局。重点在于前端（HTML/CSS/JavaScript）实现的功能和用户交互，后端技术（如Go）主要用于提供Web服务（服务HTML页面和处理WebSocket连接（如果需要代理）），但具体的MQTT通信逻辑将在客户端（浏览器）通过JavaScript实现。
*   **1.3 目标用户:** 需要进行MQTT消息测试、调试或简单监控的开发人员、测试人员或物联网爱好者。

**2. 总体描述**

该应用程序是一个单页Web应用（SPA）。用户界面在视觉上分为左右两个主要区域：

*   **左侧区域:** 用于配置和执行消息**发布**（Publish）操作。
*   **右侧区域:** 用于配置**订阅**（Subscribe）操作，并实时显示接收到的消息。

应用需要首先建立与MQTT代理的连接，然后才能进行发布和订阅操作。

**3. 功能需求**

*   **3.1 连接管理**
    *   **3.1.1 配置连接参数:** 用户应能输入以下信息以连接到MQTT代理：
        *   代理地址（Broker Address）：例如 `mqtt.example.com` 或 `192.168.1.100`
        *   端口（Port）：例如 `1883`（TCP），`8883`（TLS），`8083`（WS），`8084`（WSS）
        *   客户端ID（Client ID）：用户可自定义，或由系统自动生成一个唯一的ID。
        *   连接协议：支持 `ws://` (WebSocket) 和 `wss://` (Secure WebSocket)。 （*注意：浏览器通常只能通过WebSocket连接MQTT代理*）
        *   （可选）用户名（Username）
        *   （可选）密码（Password）
    *   **3.1.2 建立连接:** 提供一个“连接”（Connect）按钮，点击后根据用户输入的参数尝试连接到MQTT代理。
    *   **3.1.3 断开连接:** 提供一个“断开连接”（Disconnect）按钮，允许用户主动断开与代理的连接。
    *   **3.1.4 连接状态显示:** 界面上应有明确的指示器显示当前的连接状态（例如：未连接、连接中、已连接、连接错误）。

*   **3.2 消息发布（左侧区域）**
    *   **3.2.1 发布目标主题:** 提供输入框，用户可指定要发布消息的目标主题（Topic）。
    *   **3.2.2 消息内容（Payload）:** 提供文本区域（Textarea）或输入框，用户可输入要发布的消息内容。
    *   **3.2.3 服务质量（QoS）:** 提供下拉选择或单选按钮，允许用户选择发布消息的QoS等级（0, 1, 2）。
    *   **3.2.4 保留消息（Retain）:** 提供复选框，允许用户选择是否将该消息设置为保留消息。
    *   **3.2.5 执行发布:** 提供一个“发布”（Publish）按钮，点击后将消息发送到指定主题。
    *   **3.2.6 发布反馈:** （可选）在发布区域或状态栏显示发布成功或失败的简短提示。
    *   **3.2.7 （可选）已发送消息列表:** 在左侧区域显示用户最近发送的消息记录（主题、内容、时间戳）。

*   **3.3 消息订阅与接收（右侧区域）**
    *   **3.3.1 订阅主题:** 提供输入框，用户可指定要订阅的主题（支持通配符 `+` 和 `#`）。
    *   **3.3.2 服务质量（QoS）:** 提供下拉选择或单选按钮，允许用户选择订阅的QoS等级（0, 1, 2）。
    *   **3.3.3 执行订阅:** 提供一个“订阅”（Subscribe）按钮，点击后向代理请求订阅指定主题。
    *   **3.3.4 管理活动订阅:** （可选）显示当前已成功订阅的主题列表，并提供“取消订阅”（Unsubscribe）按钮。
    *   **3.3.5 接收消息显示:**
        *   在右侧区域的主要部分，实时显示从已订阅主题接收到的消息。
        *   每条接收到的消息应清晰展示：
            *   来源主题（Topic）
            *   消息内容（Payload）
            *   接收时间戳（Timestamp）
            *   （可选）接收时使用的QoS等级
        *   新消息应添加到列表的顶部或底部（需明确）。
        *   消息列表应可滚动查看历史消息。
    *   **3.3.6 清空接收区:** 提供一个“清空”（Clear）按钮，用于清除右侧显示的所有已接收消息。

*   **3.4 错误处理与反馈**
    *   **3.4.1 连接错误:** 当连接失败（如地址错误、认证失败、网络问题）时，应向用户显示清晰的错误信息。
    *   **3.4.2 发布/订阅错误:** 操作失败时（如无连接、权限不足），应给出相应的错误提示。
    *   **3.4.3 运行时错误:** 处理MQTT客户端库可能抛出的其他运行时错误，并提供适当反馈。

**4. 非功能需求**

*   **4.1 用户界面 (UI):**
    *   简洁直观，易于理解和操作。
    *   布局清晰，左右区域划分明确。
    *   视觉元素（按钮、输入框、状态指示器）应具有一致性。
*   **4.2 性能:**
    *   界面响应及时，不因接收少量消息而卡顿。
    *   能处理中等频率的消息流（具体指标可后续定义），避免浏览器崩溃或无响应。
*   **4.3 安全性:**
    *   支持通过 `ws://` 进行加密连接,不需要支持`wss://`因为是单击使用。
    *   （注意）避免在客户端JavaScript代码中硬编码敏感信息（如默认密码）。用户输入的密码应仅用于当次连接，不在本地持久化存储（除非有特定安全措施）。
*   **4.4 兼容性:**
    *   应能在主流现代桌面浏览器上运行（如 Chrome, Firefox, Edge, Safari 最新版本）。
*   **4.5 可靠性:**
    *   连接状态应准确反映实际情况。
    *   断线后应能正确显示状态，并允许用户尝试重连。

**5. 技术要求与假设**

*   **5.1 前端技术:** 使用 HTML5, CSS3, JavaScript。
*   **5.2 MQTT 客户端库:** 需要选用一个支持WebSocket的JavaScript MQTT客户端库（例如：Eclipse Paho JavaScript Client, MQTT.js）。
*   **5.3 通信协议:** 客户端与MQTT代理之间必须使用WebSocket (`ws://` 或 `wss://`) 进行通信，因为标准TCP连接无法直接从浏览器发起。
*   **5.4 后端技术 (Go):**
    *   Go后端的主要职责是提供静态Web服务器，用于托管HTML、CSS、JavaScript文件。
    *   *除非需要特殊的代理或业务逻辑*，否则Go后端**不直接参与**MQTT消息的收发。MQTT连接和通信逻辑完全由浏览器端的JavaScript库处理，直接连接到用户指定的MQTT代理。

**6. 用户界面 (UI) 布局草图**

```
+-----------------------------------------------------------------------------+
|                            Web MQTT 客户端                                  |
| 连接状态: [已连接/未连接/连接中...]                                           |
+-----------------------------------------------------------------------------+
| 代理地址: [____________________] 端口: [_____] 客户端ID: [_________________] |
| 协议: [ws:// | wss:// v]  用户名: [___________] 密码: [********]          |
| [ 连接 ] [ 断开连接 ]                                                       |
+-----------------------------------------+-----------------------------------+
|             发布区域 (左侧)             |         订阅与接收区域 (右侧)       |
+-----------------------------------------+-----------------------------------+
| 主题:    [__________________________]   | 主题:    [_________________________] |
| QoS:     [0 v] 保留消息: [ ]           | QoS:     [0 v]                    |
| 消息体 (Payload):                       | [ 订阅 ] [ 取消订阅 (待定)]       |
| +-------------------------------------+ | [ 清空接收区 ]                    |
| |                                     | |                                   |
| | (消息内容输入区)                    | | 当前订阅: (可选)                  |
| |                                     | | - topic/a                         |
| |                                     | | - sensor/+/data                   |
| +-------------------------------------+ |                                   |
| [ 发布 ]                                |-----------------------------------|
|                                         | 接收到的消息:                     |
| (可选: 已发送消息列表)                  | +---------------------------------+ |
| - 主题: x, 消息体: y, 时间: z           | | [时间戳] 主题: sensor/1/data    | |
|                                         | |   消息体: {"temp": 25.5}        | |
|                                         | | [时间戳] 主题: topic/a          | |
|                                         | |   消息体: Hello World!          | |
|                                         | | ...                             | |
|                                         | |                                 | |
|                                         | |                                 | |
|                                         | +---------------------------------+ |
+-----------------------------------------+-----------------------------------+
```

**7. 未来考虑（可选）**

*   保存和加载连接配置。
*   更高级的发布/订阅选项（如 MQTT v5 属性）。
*   消息内容的格式化显示（如 JSON、Hex）。
*   消息过滤和搜索功能。
*   UI主题定制。

---

这份文档概述了Web版MQTT客户端的主要需求。在开发过程中，可以根据实际情况进行调整和细化。